{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\gagan\\\\Plane-Rush\\\\src\\\\pages\\\\Game.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useCallback, useContext, useEffect, useRef, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { GameContext } from '../utils/web3';\nimport { useGame } from '../phaser/hooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst GameScreen = () => {\n  _s();\n\n  const {\n    state\n  } = useContext(GameContext);\n  const [ended, setEnded] = useState(false);\n  const router = useHistory();\n  const parentEl = useRef(null);\n  const game = useGame(parentEl);\n  const endGame = useCallback(score => {\n    var _localStorage$getItem;\n\n    const currHighScore = parseInt(state.highScore);\n    if (score > parseFloat((_localStorage$getItem = localStorage.getItem('highScore')) !== null && _localStorage$getItem !== void 0 ? _localStorage$getItem : '0')) localStorage.setItem('highScore', '' + score);\n\n    if (score - currHighScore > 100) {\n      alert(`New high score of ${score}!!\\nA mystery character is being created for you.\\nCheck in after a few minutes`);\n\n      try {\n        state.contract.methods.requestNewRandomCharacter(score.toString()).send({\n          from: state.account,\n          gasPrice: state.web3.utils.toWei('50', 'Gwei'),\n          gas: 500000\n        });\n      } catch (e) {\n        console.error('character generation error');\n        console.error(e);\n      }\n    }\n\n    setEnded(true);\n  }, [state]);\n  useEffect(() => {\n    if (state.loaded) {\n      if (game && !ended) {\n        console.log('starting game');\n        game.scene.scenes[0].events.emit('start-game', {\n          url: state.selectedNFT.image,\n          speed: state.selectedNFT.speed / 100,\n          endGame\n        });\n      }\n\n      if (ended) {\n        console.log('rerouting');\n        router.push('/home');\n      }\n    }\n  }, [game, state, ended, endGame, router]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: parentEl,\n    style: {\n      height: '100vh',\n      width: '100vw',\n      overflow: 'hidden'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n};\n\n_s(GameScreen, \"TxbGn3uq2Tp2qr5DVbAInJXAhqw=\", false, function () {\n  return [useHistory, useGame];\n});\n\n_c = GameScreen;\nexport default GameScreen;\n\nvar _c;\n\n$RefreshReg$(_c, \"GameScreen\");","map":{"version":3,"sources":["C:/Users/gagan/Plane-Rush/src/pages/Game.tsx"],"names":["React","useCallback","useContext","useEffect","useRef","useState","useHistory","GameContext","useGame","GameScreen","state","ended","setEnded","router","parentEl","game","endGame","score","currHighScore","parseInt","highScore","parseFloat","localStorage","getItem","setItem","alert","contract","methods","requestNewRandomCharacter","toString","send","from","account","gasPrice","web3","utils","toWei","gas","e","console","error","loaded","log","scene","scenes","events","emit","url","selectedNFT","image","speed","push","height","width","overflow"],"mappings":"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","sourcesContent":["import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport { GameContext } from '../utils/web3';\r\nimport { useGame } from '../phaser/hooks';\r\n\r\nconst GameScreen = () => {\r\n  const { state } = useContext(GameContext);\r\n  const [ended, setEnded] = useState(false);\r\n  const router = useHistory();\r\n  const parentEl = useRef<HTMLDivElement>(null);\r\n  const game = useGame(parentEl);\r\n\r\n  const endGame = useCallback(\r\n    (score: number) => {\r\n      const currHighScore = parseInt(state.highScore);\r\n      if (score > parseFloat(localStorage.getItem('highScore') ?? '0'))\r\n        localStorage.setItem('highScore', '' + score);\r\n      if (score - currHighScore > 100) {\r\n        alert(\r\n          `New high score of ${score}!!\\nA mystery character is being created for you.\\nCheck in after a few minutes`\r\n        );\r\n        try {\r\n          state.contract.methods\r\n            .requestNewRandomCharacter(score.toString())\r\n            .send({\r\n              from: state.account,\r\n              gasPrice: state.web3.utils.toWei('50', 'Gwei'),\r\n              gas: 500000,\r\n            });\r\n        } catch (e) {\r\n          console.error('character generation error');\r\n          console.error(e);\r\n        }\r\n      }\r\n      setEnded(true);\r\n    },\r\n    [state]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (state.loaded) {\r\n      if (game && !ended) {\r\n        console.log('starting game');\r\n        game.scene.scenes[0].events.emit('start-game', {\r\n          url: state.selectedNFT.image,\r\n          speed: state.selectedNFT.speed / 100,\r\n          endGame,\r\n        });\r\n      }\r\n      if (ended) {\r\n        console.log('rerouting');\r\n        router.push('/home');\r\n      }\r\n    }\r\n  }, [game, state, ended, endGame, router]);\r\n\r\n  return (\r\n    <div\r\n      ref={parentEl}\r\n      style={{ height: '100vh', width: '100vw', overflow: 'hidden' }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default GameScreen;\r\n"]},"metadata":{},"sourceType":"module"}